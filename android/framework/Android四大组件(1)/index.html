<!--
  Copyright (c) 2016-2020 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!doctype html><html lang=zh class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="An Android Developer."><link href=https://blog.yorek.xyz/about-me/android/framework/Android四大组件(1)/ rel=canonical><meta name=author content="Yorek Liu"><meta name=lang:clipboard.copy content=复制><meta name=lang:clipboard.copied content=已复制><meta name=lang:search.language content=ja><meta name=lang:search.pipeline.stopwords content=True><meta name=lang:search.pipeline.trimmer content=True><meta name=lang:search.result.none content=没有找到符合条件的结果><meta name=lang:search.result.one content="找到 1 个符合条件的结果"><meta name=lang:search.result.other content="# 个符合条件的结果"><meta name=lang:search.tokenizer content=[\uff0c\u3002]+><link rel="shortcut icon" href=../../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.0.4, mkdocs-material-4.6.0"><title>Activity</title><link rel=stylesheet href=../../../assets/stylesheets/application.1b62728e.css><link rel=stylesheet href=../../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content><script src=../../../assets/javascripts/modernizr.268332fc.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../../assets/fonts/material-icons.css><link rel=manifest href=../../../manifest.webmanifest><script>
  window.ga = window.ga || function() {
    (ga.q = ga.q || []).push(arguments)
  }
  ga.l = +new Date
  /* Setup integration and send page view */
  ga("create", "UA-155096376-1", "auto")
  ga("set", "anonymizeIp", true)
  ga("send", "pageview")
  /* Register handler to log search on blur */
  document.addEventListener("DOMContentLoaded", () => {
    if (document.forms.search) {
      var query = document.forms.search.query
      query.addEventListener("blur", function() {
        if (this.value) {
          var path = document.location.pathname;
          ga("send", "pageview", path + "?q=" + this.value)
        }
      })
    }
  })
</script><script async src=https://www.google-analytics.com/analytics.js></script><!-- Determine title --><!-- The image needs to have an absolute URL --><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:title content="Yorek's - Activity"><meta property=og:description content="An Android Developer."><meta content=https://blog.yorek.xyz/about-me/android/framework/Android四大组件(1)/ property=og:url><meta property=og:image content=https://blog.yorek.xyz/about-meassets/images/banner.png><meta property=og:image:type content=image/png><meta property=og:image:width content=1200><meta property=og:image:height content=630><!-- Twitter meta tags --><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@squidfunk><meta name=twitter:creator content=@squidfunk><meta name=twitter:title content="Yorek's - Activity"><meta name=twitter:description content="An Android Developer."><meta name=twitter:image content=https://blog.yorek.xyz/about-meassets/images/banner.png></head> <body dir=ltr data-md-color-primary=white data-md-color-accent=blue> <svg class=md-svg> <defs> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#1-activity tabindex=1 class=md-skip> 跳转至 </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-header-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=24 height=24> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Yorek's </span> <span class=md-header-nav__topic> Activity </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query placeholder=搜索 autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> 键入以开始搜索 </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../3rd-library/3rd-library-source-code/ class=md-tabs__link> Android </a> </li> <li class=md-tabs__item> <a href=../../../flutter/flutter_first_project_1/ class=md-tabs__link> Flutter </a> </li> <li class=md-tabs__item> <a href=../../../leetcode/ class=md-tabs__link> LeetCode </a> </li> <li class=md-tabs__item> <a href=../../../design-pattern/design-pattern/ class=md-tabs__link> Books </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=https://blog.yorek.xyz/about-me title="Yorek's" class="md-nav__button md-logo"> <img src=../../../assets/images/favicon.ico width=48 height=48> </a> Yorek's </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Android </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Android </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-1 type=checkbox id=nav-2-1> <label class=md-nav__link for=nav-2-1> 三方库源码解析 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-1> 三方库源码解析 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../3rd-library/3rd-library-source-code/ title=Android三方库源码分析 class=md-nav__link> Android三方库源码分析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/okhttp/ title=OkHttp3源码解析 class=md-nav__link> OkHttp3源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/retrofit/ title=Retrofit2源码解析 class=md-nav__link> Retrofit2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/rxjava&rxandroid/ title="RxJava2 & RxAndroid源码解析" class=md-nav__link> RxJava2 & RxAndroid源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide1/ title="Glide v4 源码解析（一）" class=md-nav__link> Glide v4 源码解析（一） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide2/ title="Glide v4 源码解析（二）" class=md-nav__link> Glide v4 源码解析（二） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide3/ title="Glide v4 源码解析（三）" class=md-nav__link> Glide v4 源码解析（三） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide4/ title="Glide v4 源码解析（四）" class=md-nav__link> Glide v4 源码解析（四） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide5/ title="Glide v4 源码解析（五）" class=md-nav__link> Glide v4 源码解析（五） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide6/ title="Glide v4 源码解析（六）" class=md-nav__link> Glide v4 源码解析（六） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/glide7/ title="Glide v4 源码解析（七）" class=md-nav__link> Glide v4 源码解析（七） </a> </li> <li class=md-nav__item> <a href=../../3rd-library/migrate-to-glide/ title=杂记：从Picasso迁移至Glide class=md-nav__link> 杂记：从Picasso迁移至Glide </a> </li> <li class=md-nav__item> <a href=../../3rd-library/eventbus/ title=EventBus源码解析 class=md-nav__link> EventBus源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/leakcanary/ title=LeakCanary2源码解析 class=md-nav__link> LeakCanary2源码解析 </a> </li> <li class=md-nav__item> <a href=../../3rd-library/permissiondispatcher/ title=PermissionDispatcher源码解析 class=md-nav__link> PermissionDispatcher源码解析 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2 checked> <label class=md-nav__link for=nav-2-2> Framework系列 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-2> Framework系列 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Activity </label> <a href=./ title=Activity class="md-nav__link md-nav__link--active"> Activity </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1-activity class=md-nav__link> 1 Activity的生命周期 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-activity class=md-nav__link> 1.1 正常情况下Activity的生命周期 </a> </li> <li class=md-nav__item> <a href=#12-activity class=md-nav__link> 1.2 异常情况下Activity的生命周期 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#121 class=md-nav__link> 1.2.1 资源发生了改变 </a> </li> <li class=md-nav__item> <a href=#122-activity class=md-nav__link> 1.2.2 内存不足导致低优先级的activity被杀死 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-activity class=md-nav__link> 2 Activity的启动模式 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-launchmode class=md-nav__link> 2.1 LaunchMode </a> </li> <li class=md-nav__item> <a href=#22-activityflags class=md-nav__link> 2.2 Activity的Flags </a> </li> <li class=md-nav__item> <a href=#23-task class=md-nav__link> 2.3 其他管理Task的方式 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#231-taskaffinity class=md-nav__link> 2.3.1 taskAffinity </a> </li> <li class=md-nav__item> <a href=#232 class=md-nav__link> 2.3.2 清除回退栈 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-intentfilter class=md-nav__link> 3 IntentFilter的匹配规则 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-action class=md-nav__link> 3.1 action的匹配规则 </a> </li> <li class=md-nav__item> <a href=#32-category class=md-nav__link> 3.2 category的匹配规则 </a> </li> <li class=md-nav__item> <a href=#33-data class=md-nav__link> 3.3 data的匹配规则 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../Android四大组件(2)/ title=Service class=md-nav__link> Service </a> </li> <li class=md-nav__item> <a href=../Android四大组件(3)/ title=Broadcasts class=md-nav__link> Broadcasts </a> </li> <li class=md-nav__item> <a href=../Android四大组件(4)/ title="Content Providers与Fragment" class=md-nav__link> Content Providers与Fragment </a> </li> <li class=md-nav__item> <a href=../IPC机制/ title=IPC机制 class=md-nav__link> IPC机制 </a> </li> <li class=md-nav__item> <a href=../View的事件体系/ title=View的事件体系 class=md-nav__link> View的事件体系 </a> </li> <li class=md-nav__item> <a href=../View的绘制原理/ title=View的绘制原理 class=md-nav__link> View的绘制原理 </a> </li> <li class=md-nav__item> <a href=../RemoteViews/ title=RemoteViews class=md-nav__link> RemoteViews </a> </li> <li class=md-nav__item> <a href=../Drawable/ title=Android中的Drawable资源 class=md-nav__link> Android中的Drawable资源 </a> </li> <li class=md-nav__item> <a href=../Android动画/ title=Android动画 class=md-nav__link> Android动画 </a> </li> <li class=md-nav__item> <a href=../Window与WindowManager/ title=Window与WindowManager class=md-nav__link> Window与WindowManager </a> </li> <li class=md-nav__item> <a href=../四大组件启动过程/ title=四大组件启动过程 class=md-nav__link> 四大组件启动过程 </a> </li> <li class=md-nav__item> <a href=../Android消息机制/ title=Android消息机制 class=md-nav__link> Android消息机制 </a> </li> <li class=md-nav__item> <a href=../Android线程与线程池/ title=Android线程与线程池 class=md-nav__link> Android线程与线程池 </a> </li> <li class=md-nav__item> <a href=../Bitmap的缓存与加载/ title=Bitmap的缓存与加载 class=md-nav__link> Bitmap的缓存与加载 </a> </li> <li class=md-nav__item> <a href=../JNI与NDK/ title=JNI与NDK编程简介 class=md-nav__link> JNI与NDK编程简介 </a> </li> <li class=md-nav__item> <a href=../性能优化/ title=Android性能优化 class=md-nav__link> Android性能优化 </a> </li> <li class=md-nav__item> <a href=../binder1-mediaservice/ title=Binder深入理解——以MediaService为例 class=md-nav__link> Binder深入理解——以MediaService为例 </a> </li> <li class=md-nav__item> <a href=../binder2/ title=Binder深入理解——罗老师系列 class=md-nav__link> Binder深入理解——罗老师系列 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3> <label class=md-nav__link for=nav-2-3> 付费知识归档 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-3> 付费知识归档 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3-1 type=checkbox id=nav-2-3-1> <label class=md-nav__link for=nav-2-3-1> 某圈问题索引 </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-3-1> 某圈问题索引 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/zsxq/zsxq_index/ title=某圈问题索引 class=md-nav__link> 某圈问题索引 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week1-synchronized/ title=理解Java中synchronized关键词 class=md-nav__link> 理解Java中synchronized关键词 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week2-service/ title=理解Service class=md-nav__link> 理解Service </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week3-activity/ title=理解Activity的启动模式 class=md-nav__link> 理解Activity的启动模式 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week4-startActivityForResult/ title=关于startActivityForResult class=md-nav__link> 关于startActivityForResult </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week5-view/ title=关于View的知识 class=md-nav__link> 关于View的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week6-gradle/ title=关于Gradle的知识 class=md-nav__link> 关于Gradle的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week7-serialization/ title=关于序列化的知识 class=md-nav__link> 关于序列化的知识 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week10-classloader/ title=Android中的ClassLoader class=md-nav__link> Android中的ClassLoader </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week11-binder/ title=Binder简介 class=md-nav__link> Binder简介 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week12-retrofit-okhttp/ title=OkHttp和Retrofit的作用以及两者之间的联系 class=md-nav__link> OkHttp和Retrofit的作用以及两者之间的联系 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week14-jvm-gc/ title=JVM中垃圾回收策略 class=md-nav__link> JVM中垃圾回收策略 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week16-keep-app-alive/ title=进程保活 class=md-nav__link> 进程保活 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week17-android-components/ title=四大组件的作用以及多进程 class=md-nav__link> 四大组件的作用以及多进程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week20-network-protocol/ title=网络协议 class=md-nav__link> 网络协议 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week21-mvc&amp;mvp&mvvm/ title=MVC、MVP和MVVM class=md-nav__link> MVC、MVP和MVVM </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week22-android-studio-build/ title="Android Studio build过程" class=md-nav__link> Android Studio build过程 </a> </li> <li class=md-nav__item> <a href=../../paid/zsxq/week23-load-large-bitmap/ title=大尺寸图片加载问题 class=md-nav__link> 大尺寸图片加载问题 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-3-2 type=checkbox id=nav-2-3-2> <label class=md-nav__link for=nav-2-3-2> Android开发高手课 </label> <nav class=md-nav data-md-component=collapsible data-md-level=3> <label class=md-nav__title for=nav-2-3-2> Android开发高手课 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../paid/master/ title=Android开发高手课 class=md-nav__link> Android开发高手课 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_1/ title="01 | 崩溃优化（上）：关于“崩溃”那些事儿" class=md-nav__link> 01 | 崩溃优化（上）：关于“崩溃”那些事儿 </a> </li> <li class=md-nav__item> <a href=../../paid/master/crash_2/ title="02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？" class=md-nav__link> 02 | 崩溃优化（下）：应用崩溃了，你应该如何去分析？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_1/ title="03 | 内存优化（上）：4GB内存时代，再谈内存优化" class=md-nav__link> 03 | 内存优化（上）：4GB内存时代，再谈内存优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/memory_2/ title="04 | 内存优化（下）：内存优化这件事，应该从哪里着手？" class=md-nav__link> 04 | 内存优化（下）：内存优化这件事，应该从哪里着手？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_1/ title="05 | 卡顿优化（上）：你要掌握的卡顿分析方法" class=md-nav__link> 05 | 卡顿优化（上）：你要掌握的卡顿分析方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_2/ title="06 | 卡顿优化（下）：如何监控应用卡顿？" class=md-nav__link> 06 | 卡顿优化（下）：如何监控应用卡顿？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/stuck_3/ title="06补充篇 | 卡顿优化：卡顿现场与卡顿分析" class=md-nav__link> 06补充篇 | 卡顿优化：卡顿现场与卡顿分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_1/ title="07 | 启动优化（上）：从启动过程看启动速度优化" class=md-nav__link> 07 | 启动优化（上）：从启动过程看启动速度优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/start_2/ title="08 | 启动优化（下）：优化启动速度的进阶方法" class=md-nav__link> 08 | 启动优化（下）：优化启动速度的进阶方法 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_1/ title="09 | I/O优化（上）：开发工程师必备的I/O优化知识" class=md-nav__link> 09 | I/O优化（上）：开发工程师必备的I/O优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_2/ title="10 | I/O优化（中）：不同I/O方式的使用场景是什么？" class=md-nav__link> 10 | I/O优化（中）：不同I/O方式的使用场景是什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/io_3/ title="11 | I/O优化（下）：如何监控线上I/O操作？" class=md-nav__link> 11 | I/O优化（下）：如何监控线上I/O操作？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_1/ title="12 | 存储优化（上）：常见的数据存储方法有哪些？" class=md-nav__link> 12 | 存储优化（上）：常见的数据存储方法有哪些？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_2/ title="13 | 存储优化（中）：如何优化数据存储？" class=md-nav__link> 13 | 存储优化（中）：如何优化数据存储？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/storage_3/ title="14 | 存储优化（下）：数据库SQLite的使用和优化" class=md-nav__link> 14 | 存储优化（下）：数据库SQLite的使用和优化 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_1/ title="15 | 网络优化（上）：移动开发工程师必备的网络优化知识" class=md-nav__link> 15 | 网络优化（上）：移动开发工程师必备的网络优化知识 </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_2/ title="16 | 网络优化（中）：复杂多变的移动网络该如何优化？" class=md-nav__link> 16 | 网络优化（中）：复杂多变的移动网络该如何优化？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/network_3/ title="17 | 网络优化（下）：大数据下网络该如何监控？" class=md-nav__link> 17 | 网络优化（下）：大数据下网络该如何监控？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_1/ title="18 | 耗电优化（上）：从电量优化的演进看耗电分析" class=md-nav__link> 18 | 耗电优化（上）：从电量优化的演进看耗电分析 </a> </li> <li class=md-nav__item> <a href=../../paid/master/battery_2/ title="19 | 耗电优化（下）：耗电的优化方法与线上监控" class=md-nav__link> 19 | 耗电优化（下）：耗电的优化方法与线上监控 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_1/ title="20 | UI 优化（上）：UI 渲染的几个关键概念" class=md-nav__link> 20 | UI 优化（上）：UI 渲染的几个关键概念 </a> </li> <li class=md-nav__item> <a href=../../paid/master/ui_2/ title="21 | UI 优化（下）：如何优化 UI 渲染？" class=md-nav__link> 21 | UI 优化（下）：如何优化 UI 渲染？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_1/ title="22 | 包体积优化（上）：如何减少安装包大小？" class=md-nav__link> 22 | 包体积优化（上）：如何减少安装包大小？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/package_2/ title="23 | 包体积优化（下）：资源优化的进阶实践" class=md-nav__link> 23 | 包体积优化（下）：资源优化的进阶实践 </a> </li> <li class=md-nav__item> <a href=../../paid/master/compile/ title="26 | 关于编译，你需要了解什么？" class=md-nav__link> 26 | 关于编译，你需要了解什么？ </a> </li> <li class=md-nav__item> <a href=../../paid/master/bytecode/ title="27 | 编译插桩的三种方法：AspectJ、ASM、ReDex" class=md-nav__link> 27 | 编译插桩的三种方法：AspectJ、ASM、ReDex </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> 日常记录 </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-2-4> 日常记录 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../other/android_alias/ title=Android马甲包的那些事儿 class=md-nav__link> Android马甲包的那些事儿 </a> </li> <li class=md-nav__item> <a href=../../other/Android-Development-Tool/ title=Android神兵利器 class=md-nav__link> Android神兵利器 </a> </li> <li class=md-nav__item> <a href=../../other/android-jenkins/ title="Jenkins for android" class=md-nav__link> Jenkins for android </a> </li> <li class=md-nav__item> <a href=../../other/FileProvider/ title=FileProvider class=md-nav__link> FileProvider </a> </li> <li class=md-nav__item> <a href=../../other/Android判断导航栏高度/ title=Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 class=md-nav__link> Android判断虚拟按键(导航栏)显示与否、高度以及获取屏幕实际高度 </a> </li> <li class=md-nav__item> <a href=../../other/Android图片选择器/ title=Android图片选择器 class=md-nav__link> Android图片选择器 </a> </li> <li class=md-nav__item> <a href=../../other/Android底部导航栏框架/ title=Android原生底部导航栏 class=md-nav__link> Android原生底部导航栏 </a> </li> <li class=md-nav__item> <a href=../../other/Android搜索栏的实现/ title=Android搜索栏的实现 class=md-nav__link> Android搜索栏的实现 </a> </li> <li class=md-nav__item> <a href=../../other/Android暂停音乐播放器的播放/ title=Android暂停酷狗、网易云音乐等音乐播放器的播放 class=md-nav__link> Android暂停酷狗、网易云音乐等音乐播放器的播放 </a> </li> <li class=md-nav__item> <a href=../../other/Android滑动返回实践/ title=Android滑动返回实践 class=md-nav__link> Android滑动返回实践 </a> </li> <li class=md-nav__item> <a href=../../other/Android程序反编译/ title=MacOS下Android程序反编译 class=md-nav__link> MacOS下Android程序反编译 </a> </li> <li class=md-nav__item> <a href=../../other/Android通讯录快速读取/ title=Android通讯录快速读取 class=md-nav__link> Android通讯录快速读取 </a> </li> <li class=md-nav__item> <a href=../../other/annotation/ title=注解的定义及解析 class=md-nav__link> 注解的定义及解析 </a> </li> <li class=md-nav__item> <a href=../../other/best_throttle_in_mvvm/ title=这可能是MVVM中最优雅的按键防抖方案 class=md-nav__link> 这可能是MVVM中最优雅的按键防抖方案 </a> </li> <li class=md-nav__item> <a href=../../other/constraintlayout/ title=ConstraintLayout使用大全 class=md-nav__link> ConstraintLayout使用大全 </a> </li> <li class=md-nav__item> <a href=../../other/dagger2/ title=初学者的Dagger2教程 class=md-nav__link> 初学者的Dagger2教程 </a> </li> <li class=md-nav__item> <a href=../../other/FAB-Behavior/ title=FloatingActionButton上滑隐藏下滑显示 class=md-nav__link> FloatingActionButton上滑隐藏下滑显示 </a> </li> <li class=md-nav__item> <a href=../../other/nestedscrolling/ title=NestedScrolling机制 class=md-nav__link> NestedScrolling机制 </a> </li> <li class=md-nav__item> <a href=../../other/porterduff/ title=使用Porter-Duff合成数字图像 class=md-nav__link> 使用Porter-Duff合成数字图像 </a> </li> <li class=md-nav__item> <a href=../../other/recyclerview-cache/ title=ListView、RecyclerView缓存策略解析 class=md-nav__link> ListView、RecyclerView缓存策略解析 </a> </li> <li class=md-nav__item> <a href=../../other/recyclerview-item-docoration/ title=RecyclerView高级特性——ItemDecoration class=md-nav__link> RecyclerView高级特性——ItemDecoration </a> </li> <li class=md-nav__item> <a href=../../other/recyclerview-others/ title=RecyclerView的一些使用细节 class=md-nav__link> RecyclerView的一些使用细节 </a> </li> <li class=md-nav__item> <a href=../../other/RecyclerView-Sort&Delete/ title=RecyclerView高级特性——拖拽排序以及滑动删除 class=md-nav__link> RecyclerView高级特性——拖拽排序以及滑动删除 </a> </li> <li class=md-nav__item> <a href=../../other/runtime/ title="Android Runtime" class=md-nav__link> Android Runtime </a> </li> <li class=md-nav__item> <a href=../../other/RxJava/ title=RxJava操作符大全 class=md-nav__link> RxJava操作符大全 </a> </li> <li class=md-nav__item> <a href=../../other/soft-keyboard-in-app/ title=App内自定义软键盘 class=md-nav__link> App内自定义软键盘 </a> </li> <li class=md-nav__item> <a href=../../other/SystemProrities/ title=普通Android程序使用SystemProrities class=md-nav__link> 普通Android程序使用SystemProrities </a> </li> <li class=md-nav__item> <a href=../../other/腾讯X5内核入坑指南/ title="腾讯TBS X5浏览器内核入坑指南" class=md-nav__link> 腾讯TBS X5浏览器内核入坑指南 </a> </li> <li class=md-nav__item> <a href=../../other/琐碎知识点/ title=琐碎知识点 class=md-nav__link> 琐碎知识点 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Flutter </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Flutter </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_1/ title=年轻人的第一个Flutter程序(1) class=md-nav__link> 年轻人的第一个Flutter程序(1) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_2/ title=年轻人的第一个Flutter程序(2) class=md-nav__link> 年轻人的第一个Flutter程序(2) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_3/ title=年轻人的第一个Flutter程序(3) class=md-nav__link> 年轻人的第一个Flutter程序(3) </a> </li> <li class=md-nav__item> <a href=../../../flutter/flutter_first_project_4/ title=年轻人的第一个Flutter程序(4) class=md-nav__link> 年轻人的第一个Flutter程序(4) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> LeetCode </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-4> LeetCode </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../leetcode/ title=算法目录 class=md-nav__link> 算法目录 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_1/ title=数据结构、算法和数据操作 class=md-nav__link> 数据结构、算法和数据操作 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_3/ title=高质量的代码 class=md-nav__link> 高质量的代码 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_4/ title=解决问题的思路 class=md-nav__link> 解决问题的思路 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_5/ title=优化时间和空间效率 class=md-nav__link> 优化时间和空间效率 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/code_interviews_6/ title=面试中的各项能力 class=md-nav__link> 面试中的各项能力 </a> </li> <li class=md-nav__item> <a href=../../../leetcode/array/ title=Array class=md-nav__link> Array </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode1-10/ title=LeetCode(1-10) class=md-nav__link> LeetCode(1-10) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode11-20/ title=LeetCode(11-20) class=md-nav__link> LeetCode(11-20) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode21-30/ title=LeetCode(21-30) class=md-nav__link> LeetCode(21-30) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode31-40/ title=LeetCode(31-40) class=md-nav__link> LeetCode(31-40) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode41-50/ title=LeetCode(41-50) class=md-nav__link> LeetCode(41-50) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode51-60/ title=LeetCode(51-60) class=md-nav__link> LeetCode(51-60) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode61-70/ title=LeetCode(61-70) class=md-nav__link> LeetCode(61-70) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode71-80/ title=LeetCode(71-80) class=md-nav__link> LeetCode(71-80) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode81-90/ title=LeetCode(81-90) class=md-nav__link> LeetCode(81-90) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode91-100/ title=LeetCode(91-100) class=md-nav__link> LeetCode(91-100) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode101-110/ title=LeetCode(101-110) class=md-nav__link> LeetCode(101-110) </a> </li> <li class=md-nav__item> <a href=../../../leetcode/leetcode111-120/ title=LeetCode(111-120) class=md-nav__link> LeetCode(111-120) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5 type=checkbox id=nav-5> <label class=md-nav__link for=nav-5> Books </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-5> Books </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-1 type=checkbox id=nav-5-1> <label class=md-nav__link for=nav-5-1> Design Pattern </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-1> Design Pattern </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../design-pattern/design-pattern/ title=设计模式概述 class=md-nav__link> 设计模式概述 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/design-principle/ title=面向对象的六大原则 class=md-nav__link> 面向对象的六大原则 </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/singleton/ title=单例模式(Singleton) class=md-nav__link> 单例模式(Singleton) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/builder/ title=建造者模式(Builder) class=md-nav__link> 建造者模式(Builder) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/prototype/ title=原型模式(Prototype) class=md-nav__link> 原型模式(Prototype) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/factory-method/ title="工厂方法模式(Factory method)" class=md-nav__link> 工厂方法模式(Factory method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/abstract-factory/ title="抽象工厂模式(Abstract factory)" class=md-nav__link> 抽象工厂模式(Abstract factory) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/proxy/ title=代理模式(Proxy) class=md-nav__link> 代理模式(Proxy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/composite/ title=组合模式(Composite) class=md-nav__link> 组合模式(Composite) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/adapter/ title=适配器模式(Adapter) class=md-nav__link> 适配器模式(Adapter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/decorator/ title=装饰模式(Decorator) class=md-nav__link> 装饰模式(Decorator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/flyweight/ title=享元模式(Flyweight) class=md-nav__link> 享元模式(Flyweight) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/facade/ title=外观模式(Facade) class=md-nav__link> 外观模式(Facade) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/bridge/ title=桥接模式(Bridge) class=md-nav__link> 桥接模式(Bridge) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/strategy/ title=策略模式(Strategy) class=md-nav__link> 策略模式(Strategy) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/state/ title=状态模式(State) class=md-nav__link> 状态模式(State) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/chain-of-responsibility/ title="责任链模式(Chain of responsibility)" class=md-nav__link> 责任链模式(Chain of responsibility) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/interpreter/ title=解释器模式(Interpreter) class=md-nav__link> 解释器模式(Interpreter) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/command/ title=命令模式(Command) class=md-nav__link> 命令模式(Command) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/observer/ title=观察者模式(Observer) class=md-nav__link> 观察者模式(Observer) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/memento/ title=备忘录模式(Memento) class=md-nav__link> 备忘录模式(Memento) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/iterator/ title=迭代器模式(Iterator) class=md-nav__link> 迭代器模式(Iterator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/template-method/ title="模版方法模式(Template method)" class=md-nav__link> 模版方法模式(Template method) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/visitor/ title=访问者模式(Visitor) class=md-nav__link> 访问者模式(Visitor) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/mediator/ title=中介者模式(Mediator) class=md-nav__link> 中介者模式(Mediator) </a> </li> <li class=md-nav__item> <a href=../../../design-pattern/confusing-design-pattern/ title=易混淆的设计模式 class=md-nav__link> 易混淆的设计模式 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-2 type=checkbox id=nav-5-2> <label class=md-nav__link for=nav-5-2> Effective Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-2> Effective Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../effective-java/effective-java/ title="Effective Java概述" class=md-nav__link> Effective Java概述 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter1/ title=创建和销毁对象 class=md-nav__link> 创建和销毁对象 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter2/ title=对于所有对象都通用的方法 class=md-nav__link> 对于所有对象都通用的方法 </a> </li> <li class=md-nav__item> <a href=../../../effective-java/chapter3/ title=类和接口 class=md-nav__link> 类和接口 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-3 type=checkbox id=nav-5-3> <label class=md-nav__link for=nav-5-3> JVM </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-3> JVM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../jvm/jvm-content/ title=深入理解Java虚拟机 class=md-nav__link> 深入理解Java虚拟机 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-memory-area-oom/ title=Java内存区域与内存溢出异常 class=md-nav__link> Java内存区域与内存溢出异常 </a> </li> <li class=md-nav__item> <a href=../../../jvm/java-gc/ title=垃圾收集器与内存分配策略 class=md-nav__link> 垃圾收集器与内存分配策略 </a> </li> <li class=md-nav__item> <a href=../../../jvm/class-struct/ title=类文件结构 class=md-nav__link> 类文件结构 </a> </li> <li class=md-nav__item> <a href=../../../jvm/load-class/ title=虚拟机类加载机制 class=md-nav__link> 虚拟机类加载机制 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-4 type=checkbox id=nav-5-4> <label class=md-nav__link for=nav-5-4> Java </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-4> Java </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../java/generics-java-kotlin/ title=Java&Kotlin在泛型方面的区别 class=md-nav__link> Java&Kotlin在泛型方面的区别 </a> </li> <li class=md-nav__item> <a href=../../../java/java-collections/ title=Java集合总结 class=md-nav__link> Java集合总结 </a> </li> <li class=md-nav__item> <a href=../../../java/java-foundation/ title=Java常见概念 class=md-nav__link> Java常见概念 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-5-5 type=checkbox id=nav-5-5> <label class=md-nav__link for=nav-5-5> Refactoring </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-5-5> Refactoring </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../refactoring/refactoring/ title=重构：改善既有代码的设计 class=md-nav__link> 重构：改善既有代码的设计 </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>目录</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1-activity class=md-nav__link> 1 Activity的生命周期 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-activity class=md-nav__link> 1.1 正常情况下Activity的生命周期 </a> </li> <li class=md-nav__item> <a href=#12-activity class=md-nav__link> 1.2 异常情况下Activity的生命周期 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#121 class=md-nav__link> 1.2.1 资源发生了改变 </a> </li> <li class=md-nav__item> <a href=#122-activity class=md-nav__link> 1.2.2 内存不足导致低优先级的activity被杀死 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-activity class=md-nav__link> 2 Activity的启动模式 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#21-launchmode class=md-nav__link> 2.1 LaunchMode </a> </li> <li class=md-nav__item> <a href=#22-activityflags class=md-nav__link> 2.2 Activity的Flags </a> </li> <li class=md-nav__item> <a href=#23-task class=md-nav__link> 2.3 其他管理Task的方式 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#231-taskaffinity class=md-nav__link> 2.3.1 taskAffinity </a> </li> <li class=md-nav__item> <a href=#232 class=md-nav__link> 2.3.2 清除回退栈 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-intentfilter class=md-nav__link> 3 IntentFilter的匹配规则 </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#31-action class=md-nav__link> 3.1 action的匹配规则 </a> </li> <li class=md-nav__item> <a href=#32-category class=md-nav__link> 3.2 category的匹配规则 </a> </li> <li class=md-nav__item> <a href=#33-data class=md-nav__link> 3.3 data的匹配规则 </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#__comments class="md-nav__link md-nav__link--active"> 评论 </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1>Activity</h1> <p>Android四大组件分别是Activity、Service、ContentProvider以及BroadcastReceiver。其中，Activity是使用最频繁的一个组件，可以翻译为界面。当然，我们常见的界面除了Activity，还有Window(这里指悬浮窗，类似于360的悬浮球)、Dialog以及Toast。Android中所有的视图都是通过Window来呈现的。</p> <p>此外，Fragment也是常用的一个容器，关于Fragment，可以查看<a href=/android/framework/Android%E5%9B%9B%E5%A4%A7%E7%BB%84%E4%BB%B6(4)/ >Android四大组件(4)</a>，两者一起看能更好的了解彼此。</p> <p>本章的主要内容有：Activity生命周期、启动模式、IntentFilter匹配规则。</p> <p>英语好的同学可以阅读<a href=https://developer.android.com/reference/android/app/Activity.html>google官方文档</a>，讲的更细。</p> <h2 id=1-activity>1 Activity的生命周期<a class=headerlink href=#1-activity title="Permanent link">&para;</a></h2> <p>Activity的生命周期分为两个部分：正常情况、异常情况。 所谓正常情况就是指在用户的参与下经历的生命周期的改变；而异常情况是指Activity因RAM不足被LMK杀死或者由于的Configuration(比如横竖屏切换、语言改变等)改变导致Activity销毁重构。</p> <h3 id=11-activity>1.1 正常情况下Activity的生命周期<a class=headerlink href=#11-activity title="Permanent link">&para;</a></h3> <p>如图，是正常情况下Activity所经历的生命周期。 </p> <p><img alt=activity_lifecycle src=/assets/images/android/activity_lifecycle.png></p> <p>各个生命周期方法解释如下：</p> <ol> <li><code>onCreate</code>：当Activity第一次创建的时候调用。在这里，我们做一些初始化工作：加载布局、初始化Activity所需要的数据等。</li> <li><code>onRestart</code>：Activity重新启动。当Activity从不可见重新变成可见状态时，此方法会被调用。</li> <li><code>onStart</code>：表示Activity正在启动，当Activity正在变成可见状态时会被调用。</li> <li><code>onResume</code>：表示Activity已经可见了，且出现在前台可与用户进行交互。</li> <li><code>onPause</code>：Activity正在停止。此时可以提交未保存的数据、停止动画或其他可能消耗CPU资源的操作。在此方法中不能执行耗时操作，因为下一个Activity不会调用onResume直到该方法执行完。</li> <li><code>onStop</code>：Activity即将停止，当Activity不在可见时调用，因为另一个Activity已经调用了onResume，并且覆盖了这个Activity。</li> <li><code>onDestroy</code>：Activity即将被销毁。</li> </ol> <p>在Activity的生命周期中有三个关键的循环：</p> <ul> <li><strong>完整生命周期</strong>：<code>onCreate</code> ~ <code>onDestory</code><br> 我们可以在onCreate中初始化所有数据，在onDestroy中释放。比如后台下载数据的线程。</li> <li><strong>可见生命周期</strong>：<code>onStart</code> ~ <code>onStop</code><br> 在此期间，用户可以看到Activity在屏幕上，但是并不在前台，因此也不能与用户进行交互。在着两个方法里可以维护需要展示给用户的资源。比如在onStart里面注册BroadcastReceiver，在onStop里面unregister。onStart、onStop会根据Activity对用户的显示、隐藏可以调用多次。</li> <li><strong>前台生命周期</strong>：<code>onResume</code> ~ <code>onPause</code><br> 在此期间，Activity在所有其他activity的上面，可以与用户进行交互。 一个activity可以频繁的经历resumed和paused状态，比如设备休眠，activity的结果返回了，接收到了新的intent等等。因此，在这两个方法里面的代码应该要非常轻量。</li> </ul> <p><strong>如果Activity A启动B，那么A和B的生命周期的生命周期调用顺序怎么样呢？</strong> <div class=codehilite><pre><span></span><span class=nl>A:</span> <span class=n>onPause</span><span class=p>()</span> <span class=n>called</span>
<span class=nl>B:</span> <span class=n>onCreate</span><span class=p>()</span> <span class=n>called</span> <span class=n>with</span><span class=p>:</span> <span class=n>savedInstanceState</span> <span class=o>=</span> <span class=o>[</span><span class=kc>null</span><span class=o>]</span>
<span class=nl>B:</span> <span class=n>onStart</span><span class=p>()</span> <span class=n>called</span>
<span class=nl>B:</span> <span class=n>onResume</span><span class=p>()</span> <span class=n>called</span>
<span class=nl>A:</span> <span class=n>onStop</span><span class=p>()</span> <span class=n>called</span>
</pre></div> 很显然，Android系统只允许一个Activity出现在前台，因此会先执行A的onPause方法使A退出前台，然后在执行B启动过程使其出现在前台，最后在调用A的onStop方法。</p> <h3 id=12-activity>1.2 异常情况下Activity的生命周期<a class=headerlink href=#12-activity title="Permanent link">&para;</a></h3> <h4 id=121>1.2.1 资源发生了改变<a class=headerlink href=#121 title="Permanent link">&para;</a></h4> <p>在默认情况下，系统配置改变将会导致当前的activity被销毁，该activity会经历正常的生命周期方法，<code>onPause</code>、<code>onStop</code>、<code>onDestroy</code>会被调用。如果此activity在前台或者用户可见，此activity会在onDestroy调用后被重新创建。</p> <p>由于activity是异常终止的，所以系统会调用<code>onSaveInstanceState(Bundle)</code>保存当前activity的状态，当activity被重新创建后，会调用<code>onRestoreInstanceState</code>；此外重新创建时Bundle也会传入<code>onCreate</code>方法中。</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p><code>onSaveInstanceState</code>将会调用在<code>onStop</code>之前，与<code>onPause</code>没有固定的时序关系。<br> <code>onRestoreInstanceState</code>在<code>onStart</code>与<code>onPostCreate</code>之间被调用。<code>onPostCreate</code>在<code>onResume</code>之前调用。</p> </div> <p>另外，在资源改变导致重新创建时，系统自动为我们做了一些恢复工作。具体某个特定的View能够为我们恢复哪些数据，可以查看View的这两个方法。</p> <p><strong>上面我们提到，在默认情况下，系统配置改变将会导致当前的activity被销毁重建，那怎么阻止该过程的发生呢？</strong></p> <p>我们可以通过配置activity的configChanges属性达到目的。比如我们不想屏幕旋转时重新创建，可以在activity添加<code>android:configChanges="orientation"</code>，如果我们想指定多个值，可以通过或操作"|"连接起来，比如"mcc|mnc" </p> <p><a href=https://developer.android.com/guide/topics/manifest/activity-element>点击查看activity的所有配置以及解释</a></p> <blockquote> <p><strong>横竖屏切换生命周期？</strong></p> <p>网上流传的横屏切换回竖屏生命周期执行两次，我看到了就觉得比较可疑。然后自己试验了下，也找了资料。现在完全不是这么回事了。</p> <ol> <li>只设置<code>configChanges="orientation"</code>和不设置这个属性，Activity都会销毁重建 </li> <li>设置<code>configChanges="orientation|keyboardHidden"</code>，Android 2.3版本不会重建，超过该版本会重建 </li> <li>设置<code>configChanges="orientation|screenSize"</code>时，在Android 4.0以上不会重建 </li> </ol> </blockquote> <p>下面是不设置时的，横屏切换回竖屏、竖屏切换回横屏时的生命周期执行顺序：</p> <p><code>onPause</code>/<code>onSaveInstanceState</code> -&gt; <code>onStop</code> -&gt; <code>onDestory</code> -&gt; <code>onCreate</code> -&gt; <code>onStart</code> -&gt; <code>onRestoreInstanceState</code> -&gt; <code>onResume</code></p> <p>注意这里<code>onSaveInstanceState</code>将会调用在<code>onStop</code>之前，与<code>onPause</code>没有固定的时序关系。</p> <h4 id=122-activity>1.2.2 内存不足导致低优先级的activity被杀死<a class=headerlink href=#122-activity title="Permanent link">&para;</a></h4> <p>这种情况下activity的数据存储、恢复的过程和1完全一样。当系统资源不足时，系统会按照activity的优先级顺序来杀死目标Activity所在的进程。Activity的优先级从高到低，可以分来三种：</p> <ol> <li>前台Activity —— 正在和用户进行交互，处于running状态</li> <li>可见但非前台 —— 比如Activity弹出了一个对话框</li> <li>后台Activity —— 已经执行了onStop</li> <li>未持有Activity和其他组件(Service和BroadcastReceiver)的 <strong>空进程</strong></li> </ol> <blockquote> <p>因此，后台工作不适合脱离四大组件而独自运行，这样容易被杀死。比较好的方式是将后台任务放入Service中，这样能保证进程有一定的优先级。</p> </blockquote> <div class="admonition tip"> <p class=admonition-title>Tip</p> <p><strong>进程优先级</strong> 可以查看<a href=/android/paid/zsxq/week16-keep-app-alive/#11>进程保活中关于进程优先级的译文</a>。</p> </div> <h2 id=2-activity>2 Activity的启动模式<a class=headerlink href=#2-activity title="Permanent link">&para;</a></h2> <p>本节的主要内容有：Activity的LaunchMode以及Flags</p> <div class="admonition info"> <p class=admonition-title>Info</p> <p>参考资料：<a href=https://developer.android.com/guide/components/activities/tasks-and-back-stack>Understand Tasks and Back Stack</a></p> </div> <p><strong>注意：</strong> 有些启动模式只能在manifest文件中进行描述，没有对应的flags；同样，有些启动模式也只能在flags中进行描述，manifest文件中不能。</p> <p>任务栈分为前台任务栈和后台任务栈，后台任务栈中的activity处于暂停状态，用户可以通过操作将后台任务栈再次调回前台。<br> 可以使用<code>adb shell dumpsys activity</code>查看任务栈信息，信息在<code>Running activities (most recent first)</code>这一栏中。</p> <h3 id=21-launchmode>2.1 LaunchMode<a class=headerlink href=#21-launchmode title="Permanent link">&para;</a></h3> <p>manifest文件有四种启动模式：standard、singleTop、singleTask、singleInstance</p> <ul> <li><code>standard</code><br> 默认的启动模式。每次启动activity都会创建一个新的实例，不管该实例是否已经存在。被启动的activity会运行在启动该activity的任务栈中。一个任务栈可以有多个activity实例。 <blockquote> <p>所以使用非Activity类型的Context启动一个standard Activity就会报错，解决该问题的办法是为待启动的Activity指定<code>FLAG_ACTIVITY_NEW_TASK</code>，这样启动的时候就会为它准备一个新的任务栈，这样待启动Activity实际上是以<code>singleTask</code>模式启动的。</p> </blockquote> </li> <li><code>singleTop</code><br> 栈顶复用模式。如果Activity已经位于任务栈的栈顶，那么Activity不会重新创建，同时其<code>onNewIntent</code>方法会被回调。</li> <li><code>singleTask</code><br> 栈内复用模式。这是一种单实例模式，只要Activity在一个栈中存在，多起启动该Activity都不会重新创建实例，和<code>singleTop</code>一样，系统会回调其<code>onNewIntent</code>方法。同时，位于该Activity上面的Activity都会被出栈，所以该启动模式具有<code>FLAG_ACTIVITY_CLEAR_TOP</code>效果。</li> <li><code>singleInstance</code><br> 单实例模式。加强版的<code>singleTask</code>，它具有<code>singleTask</code>的一些特点，此外，还强调了一点：具有该模式的Activity会单独的位于一个任务栈中。该任务栈名称和包名一样，也就是可以有多个任务栈的taskAffinity是相同的。</li> </ul> <p>无论Activity是在新Task中启动，还是在启动它的Activity所在的Task中启动，“返回”按钮始终会将用户带到上一个Activity。但是，如果启动launchMode指定为<code>singleTask</code>的Activity，则如果在后台Task中存在该Activity的实例，则将整个Task带到前台。此时，回退栈的顶部会包含被带入前台的Task中的所有活动。下图说明了这种情况。</p> <p><img alt=回退栈与singleTask src=/assets/images/android/diagram_backstack_singletask_multiactivity.png></p> <h3 id=22-activityflags>2.2 Activity的Flags<a class=headerlink href=#22-activityflags title="Permanent link">&para;</a></h3> <p>Activity中有些Flags可以影响Activity的启动模式，有些则可以影响Activity的运行状态。<code>launchMode</code>指定的属性可以被flags覆盖。</p> <p>下面主要说说常见的几个标记位：</p> <ul> <li><code>FLAG_ACTIVITY_NEW_TASK</code><br> 为Activity指定"singleTask"启动模式</li> <li><code>FLAG_ACTIVITY_SINGLE_TOP</code><br> 为Activity指定"singleTop"启动模式</li> <li><code>FLAG_ACTIVITY_CLEAR_TOP</code><br> 启动此Activity时，同一任务栈中所有位于它上面的Activity都会出栈。此Activity会调用<code>onNewIntent</code>还是重新创建与其自身启动模式有关。如果此Activity启动模式是standard，则会finish然后re-created；如果是其他的启动模式，则会调用当前实例的<code>onNewIntent</code>方法。<br> 与<code>FLAG_ACTIVITY_NEW_TASK</code>连用会使目标Activity出现在栈顶，这在有些时候是非常好用的，比如从通知栏运行Activity。</li> <li><code>FLAG_ACTIVITY_EXCLUDE_FROM_RECENTS</code><br> 包含有此标记的Activity不会出现在历史Activity中，也可以使用<code>android:excludeFromRecents="true"</code>属性</li> </ul> <blockquote> <p>Activity的启动方式有两种：<br> - 通过指定activity节点的<code>launchMode</code>属性<br> - 通过startActivity中Intent的<code>addFlags</code>方法添加标志位 </p> <p>两种方式的区别：<br> 1. 后者优先级会高于前者，即两种方式同时存在时，以后者为准<br> 2. 两种方式可使用范围不同，比如前者无法给Activity设置<code>FLAG_ACTIVITY_CLEAR_TOP</code>标识，后者无法为Activity指定<code>singleInstance</code>模式。</p> </blockquote> <h3 id=23-task>2.3 其他管理Task的方式<a class=headerlink href=#23-task title="Permanent link">&para;</a></h3> <h4 id=231-taskaffinity>2.3.1 taskAffinity<a class=headerlink href=#231-taskaffinity title="Permanent link">&para;</a></h4> <p>在activity中有一个属性可以标记该activity运行在哪个任务栈中，这个属性就是<code>android:taskAffinity</code>。<code>android:taskAffinity</code>必须为字符串，且中间必须含有包名分隔符<code>"."</code>。默认情况下，activity运行在应用包名的任务栈中，所以<code>android:taskAffinity</code>的值要与包名不同。</p> <p>该属性主要用在下面两个方面：</p> <ul> <li>当启动Activity的Intent包含<code>FLAG_ACTIVITY_NEW_TASK</code>时<br> 默认情况下，新Activity将启动到启动它的Activity的任务栈中。但是，如果传递给<code>startActivity()</code>的intent包含<code>FLAG_ACTIVITY_NEW_TASK</code>标志，系统会查找另一个任务栈以容纳新Activity。一般情况下，这是一项新的任务栈。但是，它不一定是。如果已经存在与新Activity具有相同affinity的任务栈，则会将Activity启动到该任务栈中。如果没有，系统会创建新的任务栈。 </li> <li>当Activity的<code>allowTaskReparenting</code>设置为<code>true</code>时<br> <code>allowTaskReparenting</code>属性的意思是，当下次进入前台时，是否允许此Activity从启动它的task移动到与affinity一样的task。<br> 假设有两个应用A和B，应用A中的ActivityA启动了应用B中带有<code>allowTaskReparenting</code>属性的ActivityP，然后按HOME键回到桌面，进入B应用，会发现出现的是ActivityP，而不是应用B的主ActivityB。</li> </ul> <h4 id=232>2.3.2 清除回退栈<a class=headerlink href=#232 title="Permanent link">&para;</a></h4> <p>如果用户长时间离开Task，系统将清除任务栈中除根Activity之外的所有Activity。当用户再次返回任务栈时，仅恢复根Activity。系统会以这种方式运行，是因为在很长一段时间之后，用户可能已经放弃了之前正在做的事情，并且返回任务栈以开始新的操作。</p> <p>有如下的方式可以更改该操作：</p> <p><code>alwaysRetainTaskState</code><br> 在一个任务栈的根Activity上将该属性设置为<code>true</code>，上面描述的行为就不会发生了。任务栈中所有的Activity都会保留，即使过了很长时间。</p> <p><code>clearTaskOnLaunch</code><br> 在一个任务栈的根Activity上将该属性设置为<code>true</code>，只要用户重新回到任务栈，任务栈会清除到只有根Activity。换句话说，它与<code>alwaysRetainTaskState</code>相反。即使在离开任务栈片刻之后，用户也始终会返回到初始状态的任务栈。</p> <p><code>finishOnTaskLaunch</code><br> 该属性与<code>clearTaskOnLaunch</code>类似，不同点在于该属性作用于单独的Activity上，而不是整个任务栈。它还能使包括根Activity在内的任何Activity消失。当该属性设置为<code>true</code>，Activity仍然是当前任务栈的一部分，如果用户离开然后返回任务栈，则它不再存在了。</p> <h2 id=3-intentfilter>3 IntentFilter的匹配规则<a class=headerlink href=#3-intentfilter title="Permanent link">&para;</a></h2> <div class="admonition success"> <p class=admonition-title>Success</p> <p>关于<a href=/android/framework/RemoteViews/#13-pendingintent>PendingIntent</a>在RemoteViews的文章中有介绍。</p> </div> <p>intent-filter在AndroidManifest.xml中的写法</p> <div class=codehilite><pre><span></span><span class=nt>&lt;intent-filter&gt;</span>
    <span class=nt>&lt;action</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.action.VIEW&quot;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;action</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.action.EDIT&quot;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;action</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.action.PICK&quot;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;category</span> <span class=na>android:name=</span><span class=s>&quot;android.intent.category.DEFAULT&quot;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;data</span> <span class=na>android:mimeType=</span><span class=s>&quot;vnd.android.cursor.dir/vnd.google.note&quot;</span> <span class=nt>/&gt;</span>
<span class=nt>&lt;/intent-filter&gt;</span>
</pre></div> <p>IntentFilter用在Activity的隐式调用上。IntentFilter中的过滤信息主要有action、category以及data。 只有一个Intent完全匹配上了action、category、data，才算匹配成功。一个Activity可以有多个intent-filter，只要一个Intent匹配成功了任何一组intent-filter就算成功匹配。</p> <p>IntentFilter的匹配规则代码如下：</p> <div class=codehilite><pre><span></span><span class=c1>// frameworks/base/core/java/android/content/IntentFilter.java</span>
<span class=kd>public</span> <span class=kd>final</span> <span class=kt>int</span> <span class=nf>match</span><span class=p>(</span><span class=n>String</span> <span class=n>action</span><span class=p>,</span> <span class=n>String</span> <span class=n>type</span><span class=p>,</span> <span class=n>String</span> <span class=n>scheme</span><span class=p>,</span>
            <span class=n>Uri</span> <span class=n>data</span><span class=p>,</span> <span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>categories</span><span class=p>,</span> <span class=n>String</span> <span class=n>logTag</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>action</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=n>matchAction</span><span class=p>(</span><span class=n>action</span><span class=p>))</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>NO_MATCH_ACTION</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=kt>int</span> <span class=n>dataMatch</span> <span class=o>=</span> <span class=n>matchData</span><span class=p>(</span><span class=n>type</span><span class=p>,</span> <span class=n>scheme</span><span class=p>,</span> <span class=n>data</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>dataMatch</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>dataMatch</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=n>String</span> <span class=n>categoryMismatch</span> <span class=o>=</span> <span class=n>matchCategories</span><span class=p>(</span><span class=n>categories</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>categoryMismatch</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>NO_MATCH_CATEGORY</span><span class=p>;</span>
        <span class=p>}</span>
        <span class=k>return</span> <span class=n>dataMatch</span><span class=p>;</span>
    <span class=p>}</span>
</pre></div> <blockquote> <p>总结一下总的匹配规则：</p> <ol> <li>action的匹配规则要求Intent中的action必须存在且必须和过滤规则中某个action相同</li> <li>category的匹配规则要求Intent中如果含有category，那么Intent中所有的category都必须和过滤规则中的某个category相同。</li> <li>data的匹配规则要求Intent中必须含有data数据，并且data数据能够完全匹配过滤规则中的某个data。</li> </ol> </blockquote> <h3 id=31-action>3.1 action的匹配规则<a class=headerlink href=#31-action title="Permanent link">&para;</a></h3> <p>action的匹配规则是指Intent中的action必须和intent-filter中的action匹配。一个过滤规则中可以有多个action，只要Intent中的action能够和intent-filter中任何一个action相同即可匹配成功。因此，Intent中如果没有指定action，那么匹配失败。</p> <p><strong>action的匹配规则要求Intent中的action必须存在且必须和过滤规则中某个action相同</strong></p> <div class=codehilite><pre><span></span>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>mActions</span><span class=p>;</span>

    <span class=kd>public</span> <span class=kd>final</span> <span class=kt>boolean</span> <span class=nf>matchAction</span><span class=p>(</span><span class=n>String</span> <span class=n>action</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>hasAction</span><span class=p>(</span><span class=n>action</span><span class=p>);</span>
    <span class=p>}</span>

    <span class=kd>public</span> <span class=kd>final</span> <span class=kt>boolean</span> <span class=nf>hasAction</span><span class=p>(</span><span class=n>String</span> <span class=n>action</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>return</span> <span class=n>action</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>mActions</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=n>action</span><span class=p>);</span>
    <span class=p>}</span>
</pre></div> <h3 id=32-category>3.2 category的匹配规则<a class=headerlink href=#32-category title="Permanent link">&para;</a></h3> <p><strong>category的匹配规则要求Intent中如果含有category，那么Intent中所有的category都必须和过滤规则中的某个category相同。</strong></p> <p>如果没有添加category，系统在startActivity或者startActivityForResult时会默认加上"android.intent.category.DEFAULT"这个category，所以为了我们的Activity可以接受隐式调用，需要在intent-filter中指定"android.intent.category.DEFAULT"这个category。</p> <div class=codehilite><pre><span></span>    <span class=kd>private</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>mCategories</span> <span class=o>=</span> <span class=kc>null</span><span class=p>;</span>

    <span class=kd>public</span> <span class=kd>final</span> <span class=n>String</span> <span class=nf>matchCategories</span><span class=p>(</span><span class=n>Set</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>categories</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>categories</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=n>Iterator</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>it</span> <span class=o>=</span> <span class=n>categories</span><span class=p>.</span><span class=na>iterator</span><span class=p>();</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>mCategories</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>it</span><span class=p>.</span><span class=na>hasNext</span><span class=p>()</span> <span class=o>?</span> <span class=n>it</span><span class=p>.</span><span class=na>next</span><span class=p>()</span> <span class=p>:</span> <span class=kc>null</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=k>while</span> <span class=p>(</span><span class=n>it</span><span class=p>.</span><span class=na>hasNext</span><span class=p>())</span> <span class=p>{</span>
            <span class=kd>final</span> <span class=n>String</span> <span class=n>category</span> <span class=o>=</span> <span class=n>it</span><span class=p>.</span><span class=na>next</span><span class=p>();</span>
            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>mCategories</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=n>category</span><span class=p>))</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>category</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>

        <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
    <span class=p>}</span>
</pre></div> <h3 id=33-data>3.3 <a href=https://developer.android.com/guide/topics/manifest/data-element.html>data的匹配规则</a><a class=headerlink href=#33-data title="Permanent link">&para;</a></h3> <div class=codehilite><pre><span></span><span class=nt>&lt;data</span> <span class=na>android:scheme=</span><span class=s>&quot;string&quot;</span>
      <span class=na>android:host=</span><span class=s>&quot;string&quot;</span>
      <span class=na>android:port=</span><span class=s>&quot;string&quot;</span>
      <span class=na>android:path=</span><span class=s>&quot;string&quot;</span>
      <span class=na>android:pathPattern=</span><span class=s>&quot;string&quot;</span>
      <span class=na>android:pathPrefix=</span><span class=s>&quot;string&quot;</span>
      <span class=na>android:mimeType=</span><span class=s>&quot;string&quot;</span> <span class=nt>/&gt;</span>
</pre></div> <p>data结构有点复杂。先说一下data的结构：data由mimeType和URI两部分组成。 mimeType指媒体类型，比如image/jpeg、image/png、audio/mpeg4-generic和video/*等。mimeType在Android framework的匹配是大小写敏感的，所以mimeType应该要使用小写字母。 而URI包含的数据由很多部分组成: <code>&lt;scheme&gt;://&lt;host&gt;:&lt;port&gt;[&lt;path&gt;|&lt;pathPrefix&gt;|&lt;pathPattern&gt;]</code></p> <ul> <li>scheme：URI的模式，比如http、file、content等。缺少该部分，整个URI无效。</li> <li>host：URI的主机名。缺少该部分，整个URI无效。</li> <li>port：端口号，仅当URI中指定了scheme和host时，port才是有意义的。</li> <li>path、pathPrefix、pathPattern：路径信息，必须以"/"开头。path表示完整信息；pathPattern也表示完成信息，但是它可以包含通配符"<em>"，"</em>"表示0或多个前一个字符，".<em>"表示匹配0或者多个任意字符。注意，由于正则表达式的规范，"</em>"要被转义成"*"；pathPrefix表示路径的前缀信息。</li> </ul> <p>过滤规则中如果没有写URI，则有一个默认值：content:和file:。即Intent中的URI的scheme部分必须是content或者file才能匹配。 此外，如果Intent要指定完整的data，必须使用<code>setDataAndType</code>方法，而不能调用<code>setData</code>和<code>setType</code>，着两个方法会清除对方的值。 在同一个<intent-filter>节点下所有的<data>标签都作用与同一个filter，因此下面两种写法是等价的：</p> <p><div class=codehilite><pre><span></span><span class=nt>&lt;intent-filter</span> <span class=err>.</span> <span class=err>.</span> <span class=err>.</span> <span class=nt>&gt;</span>
    <span class=nt>&lt;data</span> <span class=na>android:scheme=</span><span class=s>&quot;something&quot;</span> <span class=na>android:host=</span><span class=s>&quot;project.example.com&quot;</span> <span class=nt>/&gt;</span>
    . . .
<span class=nt>&lt;/intent-filter&gt;</span>

<span class=nt>&lt;intent-filter</span> <span class=err>.</span> <span class=err>.</span> <span class=err>.</span> <span class=nt>&gt;</span>
    <span class=nt>&lt;data</span> <span class=na>android:scheme=</span><span class=s>&quot;something&quot;</span> <span class=nt>/&gt;</span>
    <span class=nt>&lt;data</span> <span class=na>android:host=</span><span class=s>&quot;project.example.com&quot;</span> <span class=nt>/&gt;</span>
    . . .
<span class=nt>&lt;/intent-filter&gt;</span>
</pre></div> data的匹配规则和action类似，<strong>它要求Intent中必须含有data数据，并且data数据能够完全匹配过滤规则中的某个data。</strong> <div class=codehilite><pre><span></span>    <span class=kd>public</span> <span class=kd>final</span> <span class=kt>int</span> <span class=nf>matchData</span><span class=p>(</span><span class=n>String</span> <span class=n>type</span><span class=p>,</span> <span class=n>String</span> <span class=n>scheme</span><span class=p>,</span> <span class=n>Uri</span> <span class=n>data</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>final</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>types</span> <span class=o>=</span> <span class=n>mDataTypes</span><span class=p>;</span>
        <span class=kd>final</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>schemes</span> <span class=o>=</span> <span class=n>mDataSchemes</span><span class=p>;</span>

        <span class=kt>int</span> <span class=n>match</span> <span class=o>=</span> <span class=n>MATCH_CATEGORY_EMPTY</span><span class=p>;</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>types</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>schemes</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=p>((</span><span class=n>type</span> <span class=o>==</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>data</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span>
                <span class=o>?</span> <span class=p>(</span><span class=n>MATCH_CATEGORY_EMPTY</span><span class=o>+</span><span class=n>MATCH_ADJUSTMENT_NORMAL</span><span class=p>)</span> <span class=p>:</span> <span class=n>NO_MATCH_DATA</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>schemes</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>schemes</span><span class=p>.</span><span class=na>contains</span><span class=p>(</span><span class=n>scheme</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>?</span> <span class=n>scheme</span> <span class=p>:</span> <span class=s>&quot;&quot;</span><span class=p>))</span> <span class=p>{</span>
                <span class=n>match</span> <span class=o>=</span> <span class=n>MATCH_CATEGORY_SCHEME</span><span class=p>;</span>
            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>NO_MATCH_DATA</span><span class=p>;</span>
            <span class=p>}</span>

            <span class=kd>final</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>PatternMatcher</span><span class=o>&gt;</span> <span class=n>schemeSpecificParts</span> <span class=o>=</span> <span class=n>mDataSchemeSpecificParts</span><span class=p>;</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>schemeSpecificParts</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>data</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                <span class=n>match</span> <span class=o>=</span> <span class=n>hasDataSchemeSpecificPart</span><span class=p>(</span><span class=n>data</span><span class=p>.</span><span class=na>getSchemeSpecificPart</span><span class=p>())</span>
                        <span class=o>?</span> <span class=n>MATCH_CATEGORY_SCHEME_SPECIFIC_PART</span> <span class=p>:</span> <span class=n>NO_MATCH_DATA</span><span class=p>;</span>
            <span class=p>}</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>match</span> <span class=o>!=</span> <span class=n>MATCH_CATEGORY_SCHEME_SPECIFIC_PART</span><span class=p>)</span> <span class=p>{</span>
                <span class=c1>// If there isn&#39;t any matching ssp, we need to match an authority.</span>
                <span class=kd>final</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>AuthorityEntry</span><span class=o>&gt;</span> <span class=n>authorities</span> <span class=o>=</span> <span class=n>mDataAuthorities</span><span class=p>;</span>
                <span class=k>if</span> <span class=p>(</span><span class=n>authorities</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                    <span class=kt>int</span> <span class=n>authMatch</span> <span class=o>=</span> <span class=n>matchDataAuthority</span><span class=p>(</span><span class=n>data</span><span class=p>);</span>
                    <span class=k>if</span> <span class=p>(</span><span class=n>authMatch</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
                        <span class=kd>final</span> <span class=n>ArrayList</span><span class=o>&lt;</span><span class=n>PatternMatcher</span><span class=o>&gt;</span> <span class=n>paths</span> <span class=o>=</span> <span class=n>mDataPaths</span><span class=p>;</span>
                        <span class=k>if</span> <span class=p>(</span><span class=n>paths</span> <span class=o>==</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                            <span class=n>match</span> <span class=o>=</span> <span class=n>authMatch</span><span class=p>;</span>
                        <span class=p>}</span> <span class=k>else</span> <span class=k>if</span> <span class=p>(</span><span class=n>hasDataPath</span><span class=p>(</span><span class=n>data</span><span class=p>.</span><span class=na>getPath</span><span class=p>()))</span> <span class=p>{</span>
                            <span class=n>match</span> <span class=o>=</span> <span class=n>MATCH_CATEGORY_PATH</span><span class=p>;</span>
                        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                            <span class=k>return</span> <span class=n>NO_MATCH_DATA</span><span class=p>;</span>
                        <span class=p>}</span>
                    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                        <span class=k>return</span> <span class=n>NO_MATCH_DATA</span><span class=p>;</span>
                    <span class=p>}</span>
                <span class=p>}</span>
            <span class=p>}</span>
            <span class=c1>// If neither an ssp nor an authority matched, we&#39;re done.</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>match</span> <span class=o>==</span> <span class=n>NO_MATCH_DATA</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>NO_MATCH_DATA</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=c1>// Special case: match either an Intent with no data URI,</span>
            <span class=c1>// or with a scheme: URI.  This is to give a convenience for</span>
            <span class=c1>// the common case where you want to deal with data in a</span>
            <span class=c1>// content provider, which is done by type, and we don&#39;t want</span>
            <span class=c1>// to force everyone to say they handle content: or file: URIs.</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>scheme</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=s>&quot;&quot;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>scheme</span><span class=p>)</span>
                    <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=s>&quot;content&quot;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>scheme</span><span class=p>)</span>
                    <span class=o>&amp;&amp;</span> <span class=o>!</span><span class=s>&quot;file&quot;</span><span class=p>.</span><span class=na>equals</span><span class=p>(</span><span class=n>scheme</span><span class=p>))</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>NO_MATCH_DATA</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>

        <span class=k>if</span> <span class=p>(</span><span class=n>types</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>findMimeType</span><span class=p>(</span><span class=n>type</span><span class=p>))</span> <span class=p>{</span>
                <span class=n>match</span> <span class=o>=</span> <span class=n>MATCH_CATEGORY_TYPE</span><span class=p>;</span>
            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>NO_MATCH_TYPE</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
            <span class=c1>// If no MIME types are specified, then we will only match against</span>
            <span class=c1>// an Intent that does not have a MIME type.</span>
            <span class=k>if</span> <span class=p>(</span><span class=n>type</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
                <span class=k>return</span> <span class=n>NO_MATCH_TYPE</span><span class=p>;</span>
            <span class=p>}</span>
        <span class=p>}</span>

        <span class=k>return</span> <span class=n>match</span> <span class=o>+</span> <span class=n>MATCH_ADJUSTMENT_NORMAL</span><span class=p>;</span>
    <span class=p>}</span>
</pre></div></p> <p>最后，通过隐式启动Activity时，如果没有Activity能够匹配我们的隐式Intent，我们startActivity就会报错。 我们有两种方法解决：<br> 1. 可以使用PackageManager或者Intent的<code>resolveActivity</code>方法，如果没有匹配的Activity则会返回null。（Intent的该方法是基于PackageManager的同名方法的。）<br> 2. 可以使用PackageManager的<code>queryIntentActivities</code>方法，该方法会返回所有成功匹配的Activity信息，而不是resolveActivity的最佳匹配。 注意下PackageManager的第二个参数，这里要传入MATCH_DEFAULT_ONLY这个参数，这个参数的意义在于匹配声明了"android.intent.category.DEFAULT"的Activity，不然匹配上的Activity不一定可以成功启动。</p> <div class=codehilite><pre><span></span>    <span class=c1>// PackageManager</span>
    <span class=kd>public</span> <span class=kd>abstract</span> <span class=n>ResolveInfo</span> <span class=nf>resolveActivity</span><span class=p>(</span><span class=n>Intent</span> <span class=n>intent</span><span class=p>,</span>
            <span class=nd>@ResolveInfoFlags</span> <span class=kt>int</span> <span class=n>flags</span><span class=p>);</span>
    <span class=kd>public</span> <span class=kd>abstract</span> <span class=n>List</span><span class=o>&lt;</span><span class=n>ResolveInfo</span><span class=o>&gt;</span> <span class=nf>queryIntentActivities</span><span class=p>(</span><span class=n>Intent</span> <span class=n>intent</span><span class=p>,</span>
            <span class=nd>@ResolveInfoFlags</span> <span class=kt>int</span> <span class=n>flags</span><span class=p>);</span>

    <span class=c1>// Intent</span>
    <span class=kd>public</span> <span class=n>ComponentName</span> <span class=nf>resolveActivity</span><span class=p>(</span><span class=n>PackageManager</span> <span class=n>pm</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>mComponent</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=n>mComponent</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=n>ResolveInfo</span> <span class=n>info</span> <span class=o>=</span> <span class=n>pm</span><span class=p>.</span><span class=na>resolveActivity</span><span class=p>(</span>
            <span class=k>this</span><span class=p>,</span> <span class=n>PackageManager</span><span class=p>.</span><span class=na>MATCH_DEFAULT_ONLY</span><span class=p>);</span>
        <span class=k>if</span> <span class=p>(</span><span class=n>info</span> <span class=o>!=</span> <span class=kc>null</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>return</span> <span class=k>new</span> <span class=n>ComponentName</span><span class=p>(</span>
                    <span class=n>info</span><span class=p>.</span><span class=na>activityInfo</span><span class=p>.</span><span class=na>applicationInfo</span><span class=p>.</span><span class=na>packageName</span><span class=p>,</span>
                    <span class=n>info</span><span class=p>.</span><span class=na>activityInfo</span><span class=p>.</span><span class=na>name</span><span class=p>);</span>
        <span class=p>}</span>

        <span class=k>return</span> <span class=kc>null</span><span class=p>;</span>
    <span class=p>}</span>
</pre></div> <hr> <div class=md-source-date> <small> 最后更新: 2020年1月14日 </small> </div> <h2 id=__comments>评论</h2> <div id=disqus_thread></div> <script>
    var disqus_config = function () {
      this.page.url = "https://blog.yorek.xyz/about-me/android/framework/Android四大组件(1)/";
      this.page.identifier =
        "/android/framework/Android四大组件(1)/";
    };
    (function() {
      var d = document, s = d.createElement("script");
      s.src = "//yorekliu.disqus.com/embed.js";
      s.setAttribute("data-timestamp", +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../../3rd-library/permissiondispatcher/ title=PermissionDispatcher源码解析 class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 上一页 </span> PermissionDispatcher源码解析 </span> </div> </a> <a href=../Android四大组件(2)/ title=Service class="md-flex md-footer-nav__link md-footer-nav__link--next" rel=next> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> 下一页 </span> Service </span> </div> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> &copy; 2020 Yorek </div> powered by <a href=https://www.mkdocs.org>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ > Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../../assets/fonts/font-awesome.css> <a href=https://github.com/YorekLiu class="md-footer-social__link fa fa-github"></a> <a href=lyytogether@gmail.com class="md-footer-social__link fa fa-email"></a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/application.808e90bb.js></script> <script src=../../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script src=../../../assets/javascripts/lunr/tinyseg.js></script> <script src=../../../assets/javascripts/lunr/lunr.ja.js></script> <script>app.initialize({version:"1.0.4",url:{base:"../../.."}})</script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script> </body> </html>