---
title: "Androidæœç´¢æ çš„å®ç°â€”â€”SearchViewä»¥åŠEditText"
excerpt: "æœç´¢æ æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æ§ä»¶äº†ï¼Œåšä¸»åœ¨å°è¯•ç³»ç»ŸåŸç”Ÿçš„SearchViewä¹‹åï¼Œé™·å…¥äº†æ²‰æ€ğŸ˜¿"
header:
  teaser: /assets/images/SearchViewå‡†å¤‡æœç´¢ã€æœç´¢ä¸­ã€æœç´¢å.png
  overlay_image: /assets/images/SearchViewå‡†å¤‡æœç´¢ã€æœç´¢ä¸­ã€æœç´¢å.png
  overlay_filter: 0.5
categories:
  - Android
tags:
  - SearchView
  - æœç´¢æ 
  - EditTextå®ç°æœç´¢æ 
toc: true
toc_label: "ç›®å½•"
toc_icon: "heart"
---

æœ¬ç¯‡æ–‡ç« ä»‹ç»Androidç³»ç»Ÿæä¾›çš„æœç´¢æ å®ç°`SearchView`ä»¥åŠç»ˆæå®ç°æ–¹æ³•`EditText`ã€‚

## 1 SearchView

`SearchView`æä¾›æœ‰ä¸¤ä¸ªå®ç°ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©å…¼å®¹åŒ…é‡Œé¢çš„`android.support.v7.widget.SearchView`ã€‚
![SearchView]({{ basepath }}/assets/images/SearchView.png)

åœ¨ActionBarä¸Šä½¿ç”¨SearchViewï¼Œéœ€è¦ä»¥ä¸‹å‡ æ­¥ï¼š

**1. ä¸ºActivityå£°æ˜ä¸€ä¸ªmenuæ–‡ä»¶**
```xml
<?xml version="1.0" encoding="utf-8"?>
<menu xmlns:android="http://schemas.android.com/apk/res/android"
      xmlns:app="http://schemas.android.com/apk/res-auto">
    <item android:id="@+id/search"
          android:title="search_title"
          android:icon="@drawable/ic_search_white"
          app:showAsAction="collapseActionView|ifRoom"
          app:actionViewClass="android.support.v7.widget.SearchView" />
</menu>
```
**2. åœ¨Activityçš„`onCreateOptionsMenu`æ–¹æ³•é‡Œé¢è®¾ç½®SearchView**
```java
@Override
public boolean onCreateOptionsMenu(Menu menu) {
    MenuInflater inflater = getMenuInflater();
    inflater.inflate(R.menu.options_menu, menu);

    // Associate searchable configuration with the SearchView
    SearchManager searchManager = (SearchManager) getSystemService(Context.SEARCH_SERVICE);
    MenuItem menuItem = menu.findItem(R.id.search);
    mSearchView = (SearchView) menuItem.getActionView();
    setUpSearchView(searchManager, mSearchView, menuItem);

    return true;
}

private void setUpSearchView(SearchManager searchManager, final SearchView mSearchView, MenuItem menuItem) {
    mSearchView.setSearchableInfo(
            searchManager.getSearchableInfo(getComponentName()));
    mSearchView.setIconifiedByDefault(true);
    mSearchView.setQueryHint("*.doc(x)");
    mSearchView.setImeOptions(EditorInfo.IME_ACTION_SEARCH);
    mSearchView.setSubmitButtonEnabled(true);
    mSearchView.onActionViewCollapsed();
    mSearchView.setOnQueryTextListener(new SearchView.OnQueryTextListener() {
        @Override
        public boolean onQueryTextSubmit(String query) {
            InputMethodManager imm = (InputMethodManager) getSystemService(Context.INPUT_METHOD_SERVICE);
            if (imm != null) {
                imm.hideSoftInputFromWindow(mSearchView.getWindowToken(), 0);
            }
            mSearchView.clearFocus();
            scheduleSearch(query);
            return true;
        }

        @Override
        public boolean onQueryTextChange(String newText) {
            return false;
        }
    });
    mSearchView.findViewById(R.id.search_close_btn).setOnClickListener(new View.OnClickListener() {
        @Override
        public void onClick(View view) {
            mSearchView.setQuery("", false);
            result.clear();
            mResultAdapter.notifyDataSetChanged();
        }
    });
}
```
SearchViewæœ‰å¾ˆå¤šAPIå¯ä¾›å®šåˆ¶ï¼Œä¸‹å›¾ä»¥æ­¤æ˜¯å‡†å¤‡æœç´¢ã€æœç´¢ä¸­ã€æœç´¢åçš„SearchViewçš„æ ·å¼ã€‚
![SearchViewå‡†å¤‡æœç´¢ã€æœç´¢ä¸­ã€æœç´¢å]({{ basepath }}/assets/images/SearchViewå‡†å¤‡æœç´¢ã€æœç´¢ä¸­ã€æœç´¢å.png)

`OnQueryTextListener`ç”¨æ¥ç›‘å¬SearchViewè¾“å…¥äº‹ä»¶ï¼Œ**è€Œæƒ³è¦æ£€æµ‹å‰å‰æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶ï¼Œå…¼å®¹æ€§æœ€å¥½çš„æ–¹å¼å°±æ˜¯é€šè¿‡`findViewById(R.id.search_close_btn)`æ‰¾åˆ°è¿™ä¸ªæ§ä»¶ï¼Œç„¶åç»™å®ƒè®¾ç½®ç‚¹å‡»äº‹ä»¶**ã€‚  
å…¶ä»–æ–¹å¼å…¼å®¹æ€§å­˜åœ¨å¾ˆå¤§é—®é¢˜ï¼Œä¸çŸ¥é“æ˜¯Bugè¿˜æ˜¯æ€ä¹ˆæ ·ã€‚

**3. ä¸ºActivityé…ç½®å±æ€§**  
1.å†™searchable.xmlæ–‡ä»¶ï¼ˆä¸çŸ¥é“è¿™ä¸ªæœ‰å•¥ç”¨ï¼Œå°è¯•è¿‡é…ç½®ï¼Œæ²¡æœ‰ç”Ÿæ•ˆã€‚éšä¾¿å†™å†™å°±OKï¼‰  

```xml
<?xml version="1.0" encoding="utf-8"?>
<searchable xmlns:android="http://schemas.android.com/apk/res/android"
    android:label="@string/app_name"
    android:hint="*.doc"/>
```

2.éœ€è¦ç»™æœç´¢Activityè®¾ç½®`meta-data`å±æ€§  

```xml
<meta-data
    android:name="android.app.searchable"
    android:resource="@xml/searchable"/>
```

3.ç»™Activityæ·»åŠ action

```xml
<action android:name="android.intent.action.SEARCH" />
```

> ä»¥ä¸Šå°±æ˜¯ç”¨ç³»ç»Ÿè‡ªå¸¦çš„SearchViewçš„ä½¿ç”¨æ–¹æ³•ã€‚

## 2 EditTextå®ç°æœç´¢æ¡†

å…¶å®ï¼Œå‘ç°é‡‡ç”¨EditTextä¿®æ”¹æ ·å¼ä»£æ›¿SearchViewï¼Œæ„Ÿè§‰æ›´æ–¹ä¾¿ã€‚
![EditTextå®ç°æœç´¢æ¡†]({{ basepath }}/assets/images/EditTextå®ç°æœç´¢æ¡†.png)

```xml
<ClearEditText
      android:id="@+id/et_search"
      android:layout_width="0dp"
      android:layout_height="match_parent"
      android:layout_weight="1"
      android:gravity="center_vertical"
      android:hint="æœç´¢å¹³å°ã€ä¿¡ç”¨å¡"
      android:textColorHint="@color/ff666666"
      android:textSize="@dimen/sp_14"
      android:textColor="@color/ff333333"
      android:singleLine="true"
      android:imeOptions="actionSearch"
      android:background="@drawable/bg_et_r14_e5e5e5"
      android:paddingLeft="@dimen/dp_8"
      android:paddingRight="@dimen/dp_8"
      android:layout_marginRight="@dimen/dp_16"
      android:layout_marginTop="@dimen/dp_8"
      android:layout_marginBottom="@dimen/dp_8"
      android:drawablePadding="@dimen/dp_9"
      android:drawableLeft="@drawable/ic_calendar_search_n"
      android:drawableRight="@drawable/ic_cell_delete_n"/>
```
ä½¿ç”¨`addTextChangedListener`ç›‘å¬æ–‡æœ¬çš„æ”¹å˜ï¼Œå·¦è¾¹çš„search iconé€šè¿‡`drawableLeft`å®ç°ï¼Œå³è¾¹åˆ é™¤æŒ‰é’®é€šè¿‡`android:drawableRight`å®ç°ã€‚èƒŒæ™¯çš„shapeå¦‚ä¸‹ï¼š
```xml
<?xml version="1.0" encoding="utf-8"?>
<shape xmlns:android="http://schemas.android.com/apk/res/android">
    <solid android:color="@color/ffe5e5e5e" />
    <corners android:radius="@dimen/dp_14" />
</shape>
```

> ä»¥ä¸Šå°±æ˜¯ç”¨EditTextä»£æ›¿SearchViewçš„æ–¹æ³•ã€‚
